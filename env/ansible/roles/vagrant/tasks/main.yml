---
- name: create temporary directory
  shell: mktemp -d
  register: tempdir
  sudo: true
  tags:
    - vagrant

- name: download vagrant
  get_url: url={{ vagrant_url }} dest={{ tempdir.stdout }}/vagrant.deb
  tags:
    - vagrant

- name: install vagrant
  command: dpkg -i {{ tempdir.stdout }}/vagrant.deb
  tags:
    - vagrant

- name: Install libvirt requirements (Debian only)
  apt: pkg={{ item }} state=present
  when: ansible_distribution == 'Debian' and vagrant_libvirt_enabled   
  with_items:
    - libxslt-dev 
    - libxml2-dev 
    - libvirt-dev
    
- name: Install libvirt requirements (CentOS only)
  yum: pkg={{ item }} state=present
  when: ansible_distribution == 'CentOS' and vagrant_libvirt_enabled   
  with_items:
    - libxslt-devel 
    - libxml2-devel 
    - libvirt-devel   
    
- name: Install libvirt plugin
  command: vagrant plugin install vagrant-libvirt
  when: vagrant_libvirt_enabled   

- name: Installgyoku
  command: gem install gyoku -v '1.2.2'
  when: vagrant_windows_enabled   
  
- name: Install windows plugin
  command: vagrant plugin install vagrant-windows
  when: vagrant_windows_enabled   

- name: cleanup temporary directory
  file: name={{ tempdir.stdout }} state=absent
  tags:
    - vagrant
