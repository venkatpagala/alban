---     
#This script is used to configure your workstation (for developer)

#sudo ansible-playbook -i hosts -c local -v workstation.yml | tee setup.log

- hosts: all
  gather_facts: true
  tasks:
    - name: group hosts by distribution
      group_by: key="{{ ansible_distribution }}-{{ ansible_distribution_version }}"

- hosts: RedHat-7*:RedHat-6*:CentOS-6*:Ubuntu-12.04:Ubuntu-14.04
  gather_facts: false
  tasks:
    - name: group hosts for supported distributions
      group_by: key="supported"

- hosts: "!supported"
  gather_facts: false
  tasks:
    - name: fail for unsupported distribution
      fail: msg="{{ ansible_distribution }} {{ ansible_distribution_version }}
                 is not a supported OS for a Tower installation.  Supported
                 OSes include Red Hat Enterprise Linux 6/7, CentOS 6, or
                 Ubuntu 12.04/14.04."

- name: apply hostname configuration
  hosts: all
  user: root
#  connection: local
  
  roles:
    - hostname
  vars_files:
    - [ "roles/hostname/defaults/main.yml" ]
  
- name: apply common configuration to all nodes
  hosts: Ubuntu-12*:Ubuntu-14*
  gather_facts: false
  user: root
#  connection: local
  
  roles:
    - common

- name: Install virtualbox
  hosts: virtualbox
  user: root
#  connection: local
  
  roles:
    - virtualbox
      
- name: Install vagrant
  hosts: vagrant
  user: root
#  connection: local
  
  roles:
    - vagrant
   
- name: Install Docker
  hosts: docker
  user: root
#  connection: local  
  roles:
    - docker

# This playbook can be run using vagrant (on virtual box). 
- name: Install locale
  hosts: locale
  user: root
#  connection: local
  
  roles:
    - locale
    
# This playbook can be run using vagrant (on virtual box). 
- name: Install zabbix-agent
  hosts: zabbix-agent
  user: root
#  connection: local
  
  roles:
    - zabbix-agent
    
# This playbook can be run using vagrant (on virtual box). 
- name: Install webmin
  hosts: webmin
  user: root
#  connection: local
  
  roles:
    - webmin
        
# This playbook can be run using vagrant (on virtual box). 
- name: Install xvbf
  hosts: xvbf
  user: root
#  connection: local
  
  roles:
    - xvbf

## This playbook can be run using vagrant (on virtual box). 
#- name: Install zfs
#  hosts: zfs
#  user: root
##  connection: local
#  
#  roles:
#    - zfs
    
#Use below only if you want your servers to be part of MGR build farm
#- name: apply administration configuration to all nodes
#  hosts: Ubuntu-12*:Ubuntu-14*
#  gather_facts: false
#  user: root
##  connection: local
#  
#  roles:
#    - administration

- name: apply common configuration to all jenkins slaves
  hosts: jenkins-slaves
  user: root
#  connection: local

  vars_files:
  - [ "roles/jenkins-slave/defaults/main.yml" ]
  - [ "roles/jenkins-slave/vars/{{ ansible_distribution }}-{{ ansible_architecture }}.yml", "roles/jenkins-slave/vars/{{ ansible_distribution }}.yml" ]

#  vars_prompt:
#  - name: jenkins_username
#    prompt: "What is your jenkins user?"
#    private: no
#  - name: jenkins_password
#    prompt: "What is your jenkins password?"
#    private: yes

  roles:
    - jenkins-slave
    
# This playbook deploys a simple standalone Tomcat 7 server. 
- name: deploy Tomcat 
  hosts: tomcat-servers 
  user: root
#  connection: local
  
  roles:
    - tomcat

# This playbook deploys a simple standalone JBoss server. 

- name: deploy Jboss 
  hosts: jboss-servers 
  user: root
#  connection: local
  
  roles:
    - jboss-standalone

# This playbook deploys a MySQL databse.  

- name: deploy MySQL and configure the databases
  hosts: dbservers
  user: root
#  connection: local
  
  roles:
    - db
    
# This playbook deploys the whole application stack in this site.  

- name: configure and deploy the webservers and application code
  hosts: webservers
  user: root
#  connection: local
  
  roles:
    - web

- name: configure supervisor
  hosts: supervisors
  user: root
#  connection: local
  roles:
    - role: supervisor
      name: webserver
      command: python -m SimpleHTTPServer
      directory: /opt/web
# user is the same as base_admin_username      
      user: ubuntu

#- name: configure supervisor
#  hosts: supervisors
#  user: root
##  connection: local
#  roles:
#    - role: supervisor
#      name: fitness
#      command: /workspace/xebium/run.sh
#      directory: /workspace/xebium
## user is the same as base_admin_username      
#      user: ubuntu
